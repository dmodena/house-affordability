<section class="calculator-section">
  <div class="calculator-container">
    <div class="section-header">
      <h2 class="section-title">Property Affordability Calculator</h2>
      <p class="section-subtitle">Calculate your path to homeownership in London</p>
      <div class="section-badge">
        <span class="badge-icon">üè†</span>
        <span class="badge-text">Financial Planning Tool</span>
      </div>
    </div>

    <div class="calculator-content">
      <div class="calculator-card">
        <form [formGroup]="calculatorForm" (ngSubmit)="calculate()" class="calculator-form">
          <div class="form-grid">
            <div class="form-group">
              <label for="salary" class="form-label">Monthly Salary</label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="salary" 
                  formControlName="salary"
                  class="form-input"
                  placeholder="Enter your monthly salary"
                  aria-describedby="salary-error"
                  (input)="onSalaryInput($event)"
                  [value]="getFormattedSalary()"
                />
                <span class="input-suffix">¬£</span>
              </div>
              @if (calculatorForm.get('salary')?.touched && calculatorForm.get('salary')?.invalid) {
                <div id="salary-error" class="error-message">
                  @if (calculatorForm.get('salary')?.hasError('required')) {
                    Monthly salary is required
                  } @else if (calculatorForm.get('salary')?.hasError('min')) {
                    Salary must be a positive number
                  }
                </div>
              }
            </div>

            <div class="form-group">
              <label for="price" class="form-label">Property Cost</label>
              <div class="input-wrapper">
                <input 
                  type="text" 
                  id="price" 
                  formControlName="price"
                  class="form-input"
                  placeholder="Enter property cost"
                  aria-describedby="price-error"
                  (input)="onPriceInput($event)"
                  [value]="getFormattedPrice()"
                />
                <span class="input-suffix">¬£</span>
              </div>
              @if (calculatorForm.get('price')?.touched && calculatorForm.get('price')?.invalid) {
                <div id="price-error" class="error-message">
                  @if (calculatorForm.get('price')?.hasError('required')) {
                    Property cost is required
                  } @else if (calculatorForm.get('price')?.hasError('min')) {
                    Property cost must be a positive number
                  }
                </div>
              }
            </div>
          </div>

          <button 
            type="submit" 
            class="calculate-button"
            [disabled]="isCalculating()"
          >
            @if (isCalculating()) {
              <span class="spinner"></span>
              Calculating...
            } @else {
              <span class="button-icon">üìä</span>
              Calculate Affordability
            }
          </button>
        </form>

        @if (advice()) {
          <div class="advice-card" role="status" aria-live="polite">
            <div class="advice-header">
              <span class="advice-icon">üí°</span>
              <h3>Financial Insight</h3>
            </div>
            <p class="advice-text">{{ advice() }}</p>
          </div>
        }

        @if (result(); as result) {
          <div class="result-card">
            <div class="result-header">
              <h3>Your Affordability Analysis</h3>
              <div class="result-badge" [class]="'result-badge ' + getResultClass()">
                {{ getResultBadge() }}
              </div>
            </div>
            
            <div class="result-content">
              <div class="result-message" [class]="'result-message ' + getResultClass()">
                {{ result.message }}
              </div>
              
              <div class="result-metrics">
                <div class="metric-item">
                  <div class="metric-icon">‚è±Ô∏è</div>
                  <div class="metric-content">
                    <div class="metric-value">{{ result.years }} years, {{ result.months }} months</div>
                    <div class="metric-label">Time to Purchase</div>
                  </div>
                </div>
                
                <div class="metric-item">
                  <div class="metric-icon">üë§</div>
                  <div class="metric-content">
                    <div class="metric-value">{{ result.totalAge }} years old</div>
                    <div class="metric-label">Age at Purchase</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        }
      </div>

      <div class="calculator-info">
        <div class="info-card">
          <h4>How This Calculator Works</h4>
          <p>
            This tool analyzes your current financial situation to estimate how long it will take to save for a property deposit in London's competitive market.
          </p>
          <ul class="info-list">
            <li>Assumes 20% down payment requirement</li>
            <li>Considers average savings rate of 15%</li>
            <li>Accounts for London's property market trends</li>
            <li>Provides realistic timeline expectations</li>
          </ul>
        </div>
        
        <div class="info-card">
          <h4>Market Context</h4>
          <p>
            London's property market requires careful financial planning. The average price-to-income ratio is currently 12.5x, making it one of the least affordable housing markets globally.
          </p>
          <div class="market-stats">
            <div class="stat">
              <span class="stat-value">¬£525K</span>
              <span class="stat-label">Average Property Price</span>
            </div>
            <div class="stat">
              <span class="stat-value">12.5x</span>
              <span class="stat-label">Price-to-Income Ratio</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
