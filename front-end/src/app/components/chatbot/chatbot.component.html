<!-- Chat Bubble Button -->
<button 
  (click)="toggleChat()"
  class="fixed bottom-6 right-6 w-16 h-16 bg-blue-600 rounded-full shadow-lg hover:bg-blue-700 transition-all duration-300 flex items-center justify-center z-50 hover:scale-110 focus:outline-none focus:ring-4 focus:ring-blue-300"
  [class.rotate-90]="isOpen()"
>
  <span *ngIf="!isOpen()" class="text-white text-3xl">ðŸ’¬</span>
  <span *ngIf="isOpen()" class="text-white text-3xl">âœ•</span>
</button>

<!-- Chat Window -->
<div 
  *ngIf="isOpen()"
  class="fixed bottom-24 right-6 w-96 max-w-[calc(100vw-3rem)] h-[500px] max-h-[calc(100vh-8rem)] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden z-50 animate-fade-in-up border border-gray-100"
>
  <!-- Header -->
  <div class="bg-gradient-to-r from-blue-600 to-blue-500 p-4 flex items-center justify-between text-white shrink-0">
    <div class="flex items-center gap-3">
      <div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
      <div>
        <h3 class="font-bold text-lg leading-none">Housing Assistant</h3>
        <span class="text-xs text-blue-100 opacity-90">Always here to help</span>
      </div>
    </div>
  </div>

  <!-- Messages Area -->
  <div class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50 scroll-smooth">
    <div 
      *ngFor="let msg of messages()" 
      class="flex flex-col"
      [class.items-end]="msg.sender === 'user'"
      [class.items-start]="msg.sender === 'bot'"
    >
      <div 
        class="max-w-[80%] p-3 rounded-2xl shadow-sm text-sm"
        [class.bg-blue-600]="msg.sender === 'user'"
        [class.text-white]="msg.sender === 'user'"
        [class.rounded-br-none]="msg.sender === 'user'"
        [class.bg-white]="msg.sender === 'bot'"
        [class.text-gray-800]="msg.sender === 'bot'"
        [class.items-start]="msg.sender === 'bot'"
        [class.rounded-bl-none]="msg.sender === 'bot'"
        [class.border]="msg.sender === 'bot'"
        [class.border-gray-100]="msg.sender === 'bot'"
      >
        {{ msg.text }}
      </div>
      <span class="text-[10px] text-gray-400 mt-1 px-1">
        {{ msg.time | date:'shortTime' }}
      </span>
    </div>
  </div>

  <!-- Input Area -->
  <div class="p-4 bg-white border-t border-gray-100 shrink-0">
    <div class="flex items-center gap-2 bg-gray-50 rounded-full px-4 py-2 border border-gray-200 focus-within:border-blue-400 focus-within:ring-2 focus-within:ring-blue-100 transition-all">
      <input 
        type="text" 
        [(ngModel)]="inputMessage"
        (keyup.enter)="sendMessage()"
        placeholder="Type a message..."
        class="flex-1 bg-transparent border-none focus:ring-0 text-sm outline-none text-gray-700 placeholder-gray-400"
      >
      <button 
        (click)="sendMessage()"
        [disabled]="!inputMessage().trim()"
        class="p-2 bg-blue-600 rounded-full text-white hover:bg-blue-700 disabled:opacity-50 disabled:hover:bg-blue-600 transition-colors"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
          <path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.925A1.5 1.5 0 005.135 9.25h6.115a.75.75 0 010 1.5H5.135a1.5 1.5 0 00-1.442 1.086l-1.414 4.926a.75.75 0 00.826.95 28.896 28.896 0 0015.293-7.154.75.75 0 000-1.115A28.897 28.897 0 003.105 2.289z" />
        </svg>
      </button>
    </div>
  </div>
</div>
